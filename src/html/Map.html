<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>System Map - Panopticon</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Courier New', monospace;
      background: #000000;
      color: #00ff00;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
    }

    .container {
      width: 100%;
      height: 100%;
      position: relative;
    }

    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: rgba(0, 20, 0, 0.95);
      border-bottom: 2px solid #00ff00;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 30px;
      z-index: 1000;
      box-shadow: 0 5px 20px rgba(0, 255, 0, 0.3);
    }

    .header h1 {
      font-size: 24px;
      letter-spacing: 3px;
      text-shadow: 0 0 10px #00ff00;
    }

    .view-tabs {
      display: flex;
      gap: 10px;
    }

    .tab-btn {
      padding: 8px 16px;
      background: transparent;
      border: 2px solid #00ff00;
      color: #00ff00;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .tab-btn:hover {
      background: #00ff00;
      color: #000;
      box-shadow: 0 0 10px #00ff00;
    }

    .tab-btn.active {
      background: #00ff00;
      color: #000;
    }

    /* Main content area */
    .content {
      position: absolute;
      top: 60px;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 30px;
      overflow: auto;
      scrollbar-width: thin;
      scrollbar-color: #00ff00 #001100;
    }

    .content::-webkit-scrollbar {
      width: 10px;
    }

    .content::-webkit-scrollbar-track {
      background: #001100;
    }

    .content::-webkit-scrollbar-thumb {
      background: #00ff00;
      border-radius: 5px;
    }

    /* View panels */
    .view-panel {
      display: none;
      animation: fadeIn 0.5s;
    }

    .view-panel.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* System Architecture View */
    .architecture-view {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 25px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .system-box {
      background: rgba(0, 50, 0, 0.3);
      border: 2px solid #00ff00;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 15px rgba(0, 255, 0, 0.2);
      transition: all 0.3s;
    }

    .system-box:hover {
      background: rgba(0, 50, 0, 0.5);
      box-shadow: 0 0 25px rgba(0, 255, 0, 0.4);
      transform: translateY(-5px);
    }

    .system-box h2 {
      color: #00ffff;
      margin-bottom: 15px;
      font-size: 18px;
      text-transform: uppercase;
      border-bottom: 1px solid #00ff00;
      padding-bottom: 10px;
    }

    .system-box .description {
      color: #00ff00;
      font-size: 13px;
      line-height: 1.6;
      margin-bottom: 15px;
    }

    .system-box .features {
      list-style: none;
      padding: 0;
    }

    .system-box .features li {
      padding: 5px 0 5px 20px;
      position: relative;
      font-size: 12px;
      color: #00cc00;
    }

    .system-box .features li::before {
      content: "‚ñ∂";
      position: absolute;
      left: 0;
      color: #00ff00;
    }

    /* Data Flow View */
    .dataflow-view {
      max-width: 1200px;
      margin: 0 auto;
    }

    .flow-diagram {
      display: flex;
      flex-direction: column;
      gap: 30px;
    }

    .flow-stage {
      background: rgba(0, 50, 0, 0.3);
      border: 2px solid #00ff00;
      border-radius: 10px;
      padding: 20px;
      position: relative;
    }

    .flow-stage::after {
      content: "‚Üì";
      position: absolute;
      bottom: -25px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 24px;
      color: #00ff00;
    }

    .flow-stage:last-child::after {
      display: none;
    }

    .flow-stage h3 {
      color: #00ffff;
      margin-bottom: 10px;
      font-size: 16px;
    }

    .flow-stage .step-content {
      color: #00ff00;
      font-size: 13px;
      line-height: 1.6;
    }

    .flow-stage .tech-stack {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #00ff00;
      font-size: 11px;
      color: #009900;
    }

    /* Guest Journey View */
    .journey-view {
      max-width: 1000px;
      margin: 0 auto;
    }

    .journey-timeline {
      position: relative;
      padding-left: 40px;
    }

    .journey-timeline::before {
      content: "";
      position: absolute;
      left: 10px;
      top: 0;
      bottom: 0;
      width: 3px;
      background: linear-gradient(to bottom, #00ff00, #00ffff);
    }

    .journey-step {
      position: relative;
      margin-bottom: 40px;
      padding: 20px;
      background: rgba(0, 50, 0, 0.3);
      border: 2px solid #00ff00;
      border-radius: 10px;
      margin-left: 20px;
    }

    .journey-step::before {
      content: "";
      position: absolute;
      left: -33px;
      top: 25px;
      width: 20px;
      height: 20px;
      background: #00ff00;
      border: 3px solid #000;
      border-radius: 50%;
      box-shadow: 0 0 10px #00ff00;
    }

    .journey-step h3 {
      color: #00ffff;
      margin-bottom: 10px;
      font-size: 16px;
    }

    .journey-step .step-description {
      color: #00ff00;
      font-size: 13px;
      line-height: 1.6;
    }

    .journey-step .step-example {
      margin-top: 10px;
      padding: 10px;
      background: rgba(0, 0, 0, 0.5);
      border-left: 3px solid #00ffff;
      font-size: 12px;
      color: #00cc00;
    }

    /* Page Map View */
    .pagemap-view {
      max-width: 1200px;
      margin: 0 auto;
    }

    .page-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .page-card {
      background: rgba(0, 50, 0, 0.3);
      border: 2px solid #00ff00;
      border-radius: 10px;
      padding: 20px;
      transition: all 0.3s;
      cursor: pointer;
    }

    .page-card:hover {
      background: rgba(0, 50, 0, 0.5);
      box-shadow: 0 0 20px rgba(0, 255, 0, 0.4);
      transform: scale(1.05);
    }

    .page-card .page-icon {
      font-size: 48px;
      margin-bottom: 10px;
      text-align: center;
    }

    .page-card h3 {
      color: #00ffff;
      text-align: center;
      margin-bottom: 10px;
      font-size: 18px;
    }

    .page-card .page-desc {
      color: #00ff00;
      font-size: 12px;
      text-align: center;
      margin-bottom: 15px;
    }

    .page-card .page-route {
      background: rgba(0, 0, 0, 0.5);
      padding: 8px;
      border-radius: 5px;
      text-align: center;
      font-size: 11px;
      color: #00cc00;
    }

    /* Stats Panel */
    .stats-panel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-box {
      background: rgba(0, 50, 0, 0.3);
      border: 2px solid #00ff00;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
    }

    .stat-box .stat-value {
      font-size: 36px;
      color: #00ffff;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .stat-box .stat-label {
      font-size: 12px;
      color: #00ff00;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* Loading animation */
    .loading {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 18px;
      color: #00ff00;
      text-align: center;
      z-index: 2000;
    }

    .loading::after {
      content: "...";
      animation: dots 1.5s steps(4, end) infinite;
    }

    @keyframes dots {
      0%, 20% { content: "."; }
      40% { content: ".."; }
      60%, 100% { content: "..."; }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        height: auto;
        padding: 15px;
      }

      .header h1 {
        font-size: 18px;
        margin-bottom: 10px;
      }

      .view-tabs {
        flex-wrap: wrap;
        justify-content: center;
      }

      .content {
        padding: 15px;
      }

      .architecture-view,
      .page-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <h1>üìç SYSTEM MAP</h1>
    <div class="view-tabs">
      <button class="tab-btn active" data-view="architecture">Architecture</button>
      <button class="tab-btn" data-view="dataflow">Data Flow</button>
      <button class="tab-btn" data-view="journey">Guest Journey</button>
      <button class="tab-btn" data-view="pages">Pages</button>
    </div>
  </div>

  <!-- Content Area -->
  <div class="content">
    <!-- Architecture View -->
    <div class="view-panel active" id="architectureView">
      <div class="stats-panel">
        <div class="stat-box">
          <div class="stat-value" id="totalPages">5</div>
          <div class="stat-label">Total Pages</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="totalBackend">3</div>
          <div class="stat-label">Backend Files</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="totalLines">~7500</div>
          <div class="stat-label">Lines of Code</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="totalCategories">7</div>
          <div class="stat-label">Analysis Categories</div>
        </div>
      </div>

      <div class="architecture-view">
        <div class="system-box">
          <h2>üé® Frontend Layer</h2>
          <div class="description">
            HTML pages providing user interfaces for different aspects of the system.
          </div>
          <ul class="features">
            <li>Display.html - Page cycling controller</li>
            <li>Intro.html - Welcome screen</li>
            <li>Wall.html - Network visualization</li>
            <li>CheckInInterface.html - Guest check-in</li>
            <li>Map.html - System overview (this page)</li>
          </ul>
        </div>

        <div class="system-box">
          <h2>‚öôÔ∏è Backend Layer</h2>
          <div class="description">
            Google Apps Script files handling data processing and business logic.
          </div>
          <ul class="features">
            <li>Code.gs - Main routing & check-in logic</li>
            <li>WallData.gs - Connection analysis</li>
            <li>Sheet_desc.gs - Documentation generator</li>
            <li>Integrates with Google Sheets API</li>
            <li>Photo storage via Google Drive</li>
          </ul>
        </div>

        <div class="system-box">
          <h2>üíæ Data Layer</h2>
          <div class="description">
            Google Sheets storing guest information and party data.
          </div>
          <ul class="features">
            <li>FRC Sheet - Main guest registry</li>
            <li>30+ data columns per guest</li>
            <li>Demographics, interests, preferences</li>
            <li>Check-in status tracking</li>
            <li>Photo URL storage</li>
          </ul>
        </div>

        <div class="system-box">
          <h2>üìä Analytics Engine</h2>
          <div class="description">
            Real-time connection building and social network analysis.
          </div>
          <ul class="features">
            <li>Age group analysis</li>
            <li>Shared interests matching</li>
            <li>Music preference clustering</li>
            <li>Zodiac compatibility</li>
            <li>Industry connections</li>
            <li>Education level grouping</li>
            <li>Social stance alignment</li>
          </ul>
        </div>

        <div class="system-box">
          <h2>üñ•Ô∏è Display Controller</h2>
          <div class="description">
            Automated presentation system cycling through all pages.
          </div>
          <ul class="features">
            <li>Auto-play mode with timers</li>
            <li>Manual navigation controls</li>
            <li>Keyboard shortcuts (‚Üê‚Üí Space F R)</li>
            <li>Progress bar tracking</li>
            <li>Fullscreen presentation mode</li>
          </ul>
        </div>

        <div class="system-box">
          <h2>üîß Configuration</h2>
          <div class="description">
            Centralized configuration files for easy customization.
          </div>
          <ul class="features">
            <li>pages.json - Page definitions</li>
            <li>CONFIG object - Backend settings</li>
            <li>Column mapping configuration</li>
            <li>Route definitions</li>
            <li>Feature toggles</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Data Flow View -->
    <div class="view-panel" id="dataflowView">
      <div class="flow-diagram">
        <div class="flow-stage">
          <h3>1. Guest Registration (Pre-Party)</h3>
          <div class="step-content">
            Guests fill out a registration form (Google Forms or similar) providing:
            ZIP code, gender, birthday, demographics, interests, music preferences, etc.
            Data is collected into the FRC (Form Responses Clean) sheet.
          </div>
          <div class="tech-stack">Tech: Google Forms ‚Üí Google Sheets</div>
        </div>

        <div class="flow-stage">
          <h3>2. Guest Arrives at Party</h3>
          <div class="step-content">
            Guest navigates to Check-In URL (?page=checkin) on their phone or at a kiosk.
            Enters ZIP + Gender + Birthday for identity verification.
            System searches FRC sheet for matching record.
          </div>
          <div class="tech-stack">Tech: CheckInInterface.html ‚Üí Code.gs (checkInGuest function)</div>
        </div>

        <div class="flow-stage">
          <h3>3. Check-In Process</h3>
          <div class="step-content">
            System marks guest as checked-in (Column AB = 'Y'), records check-in time (Column AC).
            Guest can optionally update screen name and upload a selfie.
            Photos stored in Google Drive, URL saved to FRC sheet (Column AD).
          </div>
          <div class="tech-stack">Tech: Google Apps Script ‚Üí Google Drive API ‚Üí Google Sheets API</div>
        </div>

        <div class="flow-stage">
          <h3>4. Data Processing</h3>
          <div class="step-content">
            WallData.gs retrieves all checked-in guests (getCheckedInGuests).
            Analyzes guest attributes to build connection groups.
            Creates connection objects for each category (age, interests, music, etc.).
            Identifies "unknown" guests (those who don't know the hosts).
          </div>
          <div class="tech-stack">Tech: WallData.gs (buildConnectionsByCategory function)</div>
        </div>

        <div class="flow-stage">
          <h3>5. Visualization Generation</h3>
          <div class="step-content">
            Wall.html requests data via getWallData() function.
            Places guest cards on canvas using zone-based random layout.
            Cycles through connection categories, drawing animated lines between connected guests.
            Shows unknown guests in violations panel with flashing alerts.
          </div>
          <div class="tech-stack">Tech: HTML5 Canvas + JavaScript animations</div>
        </div>

        <div class="flow-stage">
          <h3>6. Presentation Mode</h3>
          <div class="step-content">
            Display Controller (Display.html) cycles through all pages automatically.
            Shows Intro ‚Üí Wall ‚Üí Map (and any other configured pages).
            Provides manual navigation and fullscreen presentation mode.
            Real-time updates as more guests check in.
          </div>
          <div class="tech-stack">Tech: iFrame-based page controller with JavaScript</div>
        </div>
      </div>
    </div>

    <!-- Guest Journey View -->
    <div class="view-panel" id="journeyView">
      <div class="journey-timeline">
        <div class="journey-step">
          <h3>Step 1: Pre-Registration</h3>
          <div class="step-description">
            Before the party, guest receives invitation with registration form link.
            Fills out demographic and preference data (30+ fields).
          </div>
          <div class="step-example">
            <strong>Example:</strong> Sarah completes form with ZIP 10001, gender "woman",
            birthday 03/15, interests: "Art, Technology, Music"
          </div>
        </div>

        <div class="journey-step">
          <h3>Step 2: Arrival</h3>
          <div class="step-description">
            Guest arrives at party venue. Sees QR code or URL for check-in system.
          </div>
          <div class="step-example">
            <strong>URL:</strong> https://script.google.com/.../exec?page=checkin
          </div>
        </div>

        <div class="journey-step">
          <h3>Step 3: Identity Verification</h3>
          <div class="step-description">
            Guest enters ZIP code + Gender + Birthday on check-in interface.
            System validates against registration data.
          </div>
          <div class="step-example">
            Sarah enters: ZIP "10001", Gender "woman", Birthday "03/15"<br>
            ‚úÖ Match found! Welcome Sarah!
          </div>
        </div>

        <div class="journey-step">
          <h3>Step 4: Profile Enhancement (Optional)</h3>
          <div class="step-description">
            Guest can update screen name (nickname for the night).
            Take or upload a selfie for the wall display.
          </div>
          <div class="step-example">
            Sarah updates screen name to "TechArtist" and uploads selfie
          </div>
        </div>

        <div class="journey-step">
          <h3>Step 5: Live on The Wall</h3>
          <div class="step-description">
            Guest appears on The Wall visualization display.
            System shows connections with other guests who share interests, age group, etc.
            Lines animate between connected guests in real-time.
          </div>
          <div class="step-example">
            Sarah's card appears. Lines connect her to other Art & Tech enthusiasts,
            other guests in her age group, and those who share music preferences.
          </div>
        </div>

        <div class="journey-step">
          <h3>Step 6: Discovery</h3>
          <div class="step-description">
            Guest watches The Wall to discover shared connections with other attendees.
            Uses displayed information to start conversations and meet new people.
          </div>
          <div class="step-example">
            Sarah sees she's connected to 8 other guests through shared interests,
            facilitating introductions throughout the night.
          </div>
        </div>
      </div>
    </div>

    <!-- Pages Map View -->
    <div class="view-panel" id="pagesView">
      <div class="page-grid">
        <div class="page-card" onclick="openPage('controller')">
          <div class="page-icon">üñ•Ô∏è</div>
          <h3>Display Controller</h3>
          <div class="page-desc">
            Main presentation interface. Auto-cycles through all pages with configurable timers.
          </div>
          <div class="page-route">?page=controller</div>
        </div>

        <div class="page-card" onclick="openPage('intro')">
          <div class="page-icon">üé¨</div>
          <h3>Introduction</h3>
          <div class="page-desc">
            Terminal-style welcome screen with CRT effects and typing animation.
          </div>
          <div class="page-route">?page=intro</div>
        </div>

        <div class="page-card" onclick="openPage('wall')">
          <div class="page-icon">üìä</div>
          <h3>The Wall</h3>
          <div class="page-desc">
            Live network visualization showing guest connections based on shared attributes.
          </div>
          <div class="page-route">?page=wall</div>
        </div>

        <div class="page-card" onclick="openPage('checkin')">
          <div class="page-icon">‚úÖ</div>
          <h3>Check-In Interface</h3>
          <div class="page-desc">
            Guest self-service check-in with photo upload and profile updates.
          </div>
          <div class="page-route">?page=checkin</div>
        </div>

        <div class="page-card" onclick="openPage('map')">
          <div class="page-icon">üìç</div>
          <h3>System Map</h3>
          <div class="page-desc">
            Interactive overview of system architecture, data flow, and guest journey.
          </div>
          <div class="page-route">?page=map</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Tab switching
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const view = this.getAttribute('data-view');

        // Update button states
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');

        // Update view panels
        document.querySelectorAll('.view-panel').forEach(p => p.classList.remove('active'));
        document.getElementById(view + 'View').classList.add('active');
      });
    });

    // Page navigation (if opened directly, not in iframe)
    function openPage(page) {
      if (window.top !== window.self) {
        // We're in an iframe, can't navigate
        console.log('In iframe - cannot navigate');
        return;
      }

      const baseUrl = window.location.href.split('?')[0];
      window.location.href = baseUrl + '?page=' + page;
    }

    // Simulate loading stats from backend
    window.addEventListener('load', function() {
      console.log('Map loaded');

      // Could fetch real stats here
      // google.script.run.withSuccessHandler(updateStats).getSystemStats();
    });

    function updateStats(stats) {
      if (stats) {
        document.getElementById('totalPages').textContent = stats.totalPages || 5;
        document.getElementById('totalBackend').textContent = stats.backendFiles || 3;
        document.getElementById('totalLines').textContent = '~' + (stats.totalLines || 7500);
        document.getElementById('totalCategories').textContent = stats.categories || 7;
      }
    }

    // Log for debugging
    console.log('System Map initialized');
    console.log('Available views: Architecture, Data Flow, Guest Journey, Pages');
  </script>
</body>
</html>
